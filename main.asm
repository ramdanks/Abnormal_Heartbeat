;Port Assignment:
;2.0 - 2.6 = Seven Segment

SEVSEG	EQU	P1

LEDR	EQU	P2.2
LEDY	EQU	P2.3
LEDG	EQU	P2.4

RS	EQU	P2.5
RW	EQU	P2.6
ENB	EQU	P2.7

LCD16	EQU	P3
L_USE	EQU	038H
L_ON	EQU	00FH
L_CLR	EQU	001H
L_LN1	EQU	080H
L_LN2	EQU	0C0H

;=====! (DATA) !=====;
	ORG	300H

STR:	DB	'Test', 0
MSG:	DB	'Blue Pill', 0

;=====! (SUBROUTINE) !=====;
	ORG	400H

SHOW7:	MOV	A, R6
	MOV	B, #4
	SL:	RL	A
		DJNZ	B, SL
	ADD	A, R7
	MOV	SEVSEG, A
	RET

SSTR:	SETB	SCON.6
	MOV	TMOD, #20H
	MOV	TH1, R0
	SETB	TR1

	SEND:	CLR	A
		MOVC	A, @A+DPTR
		JZ	S_RET
		MOV	SBUF, A
	WAIT:	JNB	TI, WAIT
		CLR	TI

	INC	DPTR
	SJMP	SEND
	S_RET:	RET

LSTR:	CLR A
	MOVC A, @A+DPTR
	JZ L_RET
	ACALL DATLCD
	INC DPTR
	SJMP LSTR
	L_RET: RET

DELAY: 	MOV TMOD, #01H
	MOV 	TH0, B
	SETB 	TR0
	HERE:	JNB	TF0, HERE
	CLR 	TR0
	CLR 	TF0
	RET

CMDLCD:	MOV LCD16, A
	CLR RS
	CLR RW
	SETB ENB
	CLR ENB
	MOV B, #LOW(-20H)
	ACALL DELAY
	RET

DATLCD:	MOV LCD16, A
	SETB RS
	CLR RW
	SETB ENB
	CLR ENB
	MOV B, #LOW(-20H)
	ACALL DELAY
	RET

RESET:	MOV P0, #0FFH
	MOV P1, #0FFH
	MOV P2, #0FFH
	MOV P3, #0
	RET

;========! (MAIN) !========;
	ORG	00H

;Inisiasi Nyalain LCD
MOV A, #L_USE
ACALL CMDLCD
MOV A, #L_ON
ACALL CMDLCD
MOV A, #L_CLR
ACALL CMDLCD

;Print String ke LCD
MOV DPTR, #MSG
ACALL LSTR

HALT:	SJMP HALT





